var A=Object.defineProperty,J=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var L=Object.getOwnPropertySymbols;var U=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var B=(s,t,e)=>t in s?A(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,v=(s,t)=>{for(var e in t||(t={}))U.call(t,e)&&B(s,e,t[e]);if(L)for(var e of L(t))V.call(t,e)&&B(s,e,t[e]);return s},C=(s,t)=>J(s,O(t));import{M as j}from"./MTable.76dd600a.js";import{e as P,i as Y,j as G,k as $,l as H,D as K,m as Q}from"./index.c7d67714.js";import{_ as W,a as X,r as D,l as Z,m as I,c as ee,o as ae,i as te,h as le,f as E,g as p,w as R,J as oe,E as y,k as ue,t as se}from"./index.349d9e8e.js";import"./MIcon.6c4988d5.js";const ie={class:"menuManager page-container"},ne={class:"tableContainer"},re=X({setup(s){let t=D(!1);const e=Z({pageInfo:{},columns:[{prop:"name",key:"name",label:"\u89D2\u8272\u540D\u79F0"},{prop:"details",key:"details",label:"\u89D2\u8272\u63CF\u8FF0"},{prop:"column",key:"column",label:"\u6743\u9650\u5217\u8868",isCustom:!0},{prop:"time",key:"time",label:"\u521B\u5EFA\u65F6\u95F4",isCustom:!0}],roleList:[],dialogConfig:[{type:"text",label:"\u89D2\u8272\u540D\u79F0",key:"name"},{type:"text",label:"\u89D2\u8272\u63CF\u8FF0",key:"details"},{type:"tree",label:"\u6743\u9650\u5217\u8868",key:"column",options:{treeData:[],treeProp:{label:"name",value:"id",children:"children"}}}],dialogData:{}}),m=D(6),f=D(1);let k=D([]),_=D([]);const S=async()=>{let l=await Q(1,100);console.log(l),k.value=l.data.data.column;let o=[],i=[];k.value.forEach(a=>{a.grade==="1"?o.push(C(v({},a),{children:[]})):i.push(a)}),i.forEach(a=>{o=o.map(r=>{var c;return a.pid===r.id&&((c=r.children)==null||c.push(a)),r})}),_.value=o},h=async(l,o)=>{await S();let i=await P(l,o),a=await Y();i.data.code===200&&(e.roleList=i.data.data.role,e.roleList=e.roleList.map(r=>{let c=JSON.parse(r.column).map(u=>{let g={};return k.value.forEach(F=>{u==F.id&&(g=F)}),g}),d=[],n=[];return c.forEach((u,g)=>{u.grade=="1"?d.push(C(v({},u),{children:[]})):n.push(u)}),n.forEach(u=>{d=d.map(g=>(u.pid==g.id&&g.children.push(u),g))}),C(v({},r),{authList:d})}),e.pageInfo.totalCount=a.data.data.num)};h(f.value,m.value);const x=async({rowIndex:l,tableData:o,opera:i,rowInfo:a})=>{var r,c,d;switch(i){case"add":await b(),(r=e.dialogConfig)==null||r.forEach((n,u)=>{n.key==="column"&&(e.dialogConfig[u].options.treeData=_.value,console.log(e.dialogConfig))}),e.dialogData={column:[]},t.value=!0;break;case"edit":(c=e.dialogConfig)==null||c.forEach((n,u)=>{n.key==="column"&&(e.dialogConfig[u].options.treeData=_.value)}),e.dialogData=C(v({},a),{column:JSON.parse(a.column)}),t.value=!0;break;case"show":(d=e.dialogConfig)==null||d.forEach((n,u)=>{n.key==="column"&&(e.dialogConfig[u].options.treeData=a.authList)}),e.dialogData=C(v({},a),{column:JSON.parse(a.column)}),t.value=!0;break;case"delete":oe.confirm(`\u4F60\u786E\u5B9A\u8981\u5220\u9664${o[l].name}\u89D2\u8272\u5417?`,"\u8B66\u544A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning",center:!0}).then(async()=>{(await G(a.id)).data.code===200?(y({type:"success",message:"\u5220\u9664\u6210\u529F"}),h(f.value,m.value)):y({type:"error",message:"\u5220\u9664\u5931\u8D25"})}).catch(n=>{});break}},w=async l=>{switch(l.operation){case"add":(await H(l.data)).data.code===200?(y({type:"success",message:"\u65B0\u589E\u6210\u529F"}),t.value=!1,h(f.value,m.value)):y({type:"error",message:"\u6DFB\u52A0\u5931\u8D25"});break;case"edit":delete l.data.authList,delete l.data.time,console.log(l.data),(await $(l.data)).data.code===200?(y({type:"success",message:"\u66F4\u65B0\u6210\u529F"}),t.value=!1,h(f.value,m.value)):y({type:"error",message:"\u66F4\u65B0\u5931\u8D25"});break}t.value=!1},b=async l=>{},{pageInfo:M,columns:T,roleList:q,dialogConfig:N,dialogData:z}=I(e);return(l,o)=>{const i=ee("el-tree");return ae(),te("div",ie,[le("div",ne,[E(j,{columns:p(T),"table-data":p(q),pagination:{total:p(M).totalCount},pageSize:m.value,"onUpdate:pageSize":o[0]||(o[0]=a=>m.value=a),currentPage:f.value,"onUpdate:currentPage":o[1]||(o[1]=a=>f.value=a),dialogConfig:p(N),"dialog-status":p(t),"dialog-data":p(z),tableTitle:"\u89D2\u8272",onTbDialogSureClick:w,onOperaButtonClick:x,onSelectChange:b,onCurrentPageChange:h,onPageSizeChange:h},{time:R(a=>[ue(se(p(K).formatTimeStamp(a.row.time,"YY-MM-DD hh:mm:ss")),1)]),column:R(a=>[E(i,{data:a.row.authList,props:{label:"name",value:"id",children:"children"}},null,8,["data"])]),_:1},8,["columns","table-data","pagination","pageSize","currentPage","dialogConfig","dialog-status","dialog-data"])])])}}});var fe=W(re,[["__scopeId","data-v-35ccba78"]]);export{fe as default};
