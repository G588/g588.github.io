var q=Object.defineProperty,R=Object.defineProperties;var N=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var z=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var k=(u,t,a)=>t in u?q(u,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):u[t]=a,v=(u,t)=>{for(var a in t||(t={}))z.call(t,a)&&k(u,a,t[a]);if(D)for(var a of D(t))V.call(t,a)&&k(u,a,t[a]);return u},b=(u,t)=>R(u,N(t));import{M as J}from"./MTable.76dd600a.js";import{X as O,Y as U,r as Y,Z as P,_ as $,$ as I,D as X}from"./index.c7d67714.js";import{_ as Z,a as G,r as h,l as H,m as K,c as Q,o as p,i as _,h as W,f as ee,g as i,w as y,J as ae,E as m,k as F,t as x,q as w,F as te,j as se,e as oe}from"./index.349d9e8e.js";import"./MIcon.6c4988d5.js";const le={class:"controlManager page-container"},ue={class:"tableContainer"},ne={key:0},ie={key:1},re=G({setup(u){let t=h(!1);const a=H({pageInfo:{},columns:[{prop:"name",key:"name",label:"\u540D\u79F0"},{prop:"type",key:"type",label:"\u7C7B\u578B",isCustom:!0},{prop:"light_json",key:"light_json",label:"\u7ED1\u5B9A\u8BBE\u5907",isCustom:!0},{prop:"time",key:"time",label:"\u66F4\u65B0\u65F6\u95F4",isCustom:!0}],controlList:[],deviceList:[],dialogConfig:[{type:"text",label:"\u540D\u79F0",key:"name"},{type:"select",label:"\u7C7B\u578B",key:"type",child:[{label:"\u533A\u57DF",value:1},{label:"\u5355\u706F",value:2}]},{type:"selectMultiple",label:"\u7ED1\u5B9A\u8BBE\u5907",key:"light_json",child:[]}],dialogData:{}}),r=h(6),c=h(1),d=async(s,o)=>{let l=await O(s,o),e=await U();console.log(e),l.data.code===200&&(a.controlList=l.data.data.control_type,a.pageInfo.totalCount=e.data.data.num)};d(c.value,r.value),(async(s,o)=>{let l=await Y(s,o);l.data.code===200&&(console.log(l.data.data),a.deviceList=l.data.data)})(1,1e3);const E=async({rowIndex:s,tableData:o,opera:l,rowInfo:e})=>{var g;switch((g=a.dialogConfig)==null||g.forEach((n,de)=>{n.key=="light_json"&&a.deviceList.forEach((C,ge)=>{var B;(B=n.child)==null||B.push({label:C.name,value:C.id})})}),l){case"add":await f(),a.dialogData={},t.value=!0;break;case"edit":console.log("\u533A\u57DF\u5206\u7C7B\u7F16\u8F91",a.dialogData),a.dialogData=b(v({},e),{light_json:JSON.parse(e.light_json).map(n=>n.id)}),t.value=!0;break;case"show":a.dialogData=v({},e),t.value=!0;break;case"delete":ae.confirm(`\u4F60\u786E\u5B9A\u8981\u5220\u9664${o[s].name}\u89D2\u8272\u5417?`,"\u8B66\u544A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning",center:!0}).then(async()=>{await P(e.id),m({type:"success",message:"\u5220\u9664\u6210\u529F"}),d(c.value,r.value)}).catch(n=>{});break}},L=async s=>{let o=[];switch(s.data.light_json.forEach(l=>{let e=a.deviceList.find(g=>g.id==l);o.push({id:e==null?void 0:e.id})}),s.data.light_json=o,s.operation){case"add":(await I(s.data)).data.code===200?(m({type:"success",message:"\u65B0\u589E\u6210\u529F"}),t.value=!1,d(c.value,r.value)):m({type:"error",message:"\u6DFB\u52A0\u5931\u8D25"});break;case"edit":(await $(s.data)).data.code===200?(m({type:"success",message:"\u66F4\u65B0\u6210\u529F"}),t.value=!1,d(c.value,r.value)):m({type:"error",message:"\u66F4\u65B0\u5931\u8D25"});break}t.value=!1},f=async s=>{},{pageInfo:S,columns:j,controlList:A,dialogConfig:M,dialogData:T}=K(a);return(s,o)=>{const l=Q("el-tag");return p(),_("div",le,[W("div",ue,[ee(J,{columns:i(j),"table-data":i(A),pagination:{total:i(S).totalCount},pageSize:r.value,"onUpdate:pageSize":o[0]||(o[0]=e=>r.value=e),currentPage:c.value,"onUpdate:currentPage":o[1]||(o[1]=e=>c.value=e),dialogConfig:i(M),"dialog-status":i(t),"dialog-data":i(T),tableTitle:"\u63A7\u5236",onTbDialogSureClick:L,onOperaButtonClick:E,onSelectChange:f,onCurrentPageChange:d,onPageSizeChange:d},{time:y(e=>[F(x(i(X).formatTimeStamp(e.row.time,"YY-MM-DD hh:mm:ss")),1)]),type:y(e=>[e.row.type==="1"?(p(),_("span",ne,"\u533A\u57DF")):w("",!0),e.row.type==="2"?(p(),_("span",ie,"\u5355\u706F")):w("",!0)]),light_json:y(e=>[(p(!0),_(te,null,se(JSON.parse(e.row.light_json),(g,n)=>(p(),oe(l,{class:"ml-2",type:"error",key:n,style:{"margin-bottom":"4px","margin-right":"2px"}},{default:y(()=>[F(x(g.name),1)]),_:2},1024))),128))]),_:1},8,["columns","table-data","pagination","pageSize","currentPage","dialogConfig","dialog-status","dialog-data"])])])}}});var he=Z(re,[["__scopeId","data-v-8b90b982"]]);export{he as default};
